<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SOCKET IO CLIENT</title>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ socket.io -->
    <script src="https://cdn.socket.io/4.3.2/socket.io.js"></script>

</head>
<body>

<h1>SOCKET IO CLIENT</h1>
<h3>SID: <b id="socket_sid"></b></h3>
<hr>

<div>
    <h2>üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h2>
    <h4>–ù–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: <code id="new_notification"></code></h4>
</div>

<hr>

<div>
    <h2>–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –≤–µ–±-—Å–æ–∫–µ—Ç</h2>
    <input type="hidden" id="jwt_token" value="{{ jwt_token }}">
    <label for="input_message">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏</label>
    <input id="input_message" type="text">
    <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <h4>SERVER RESPONSE: <code id="server_response"></code></h4>
</div>

<hr>

<div>
    <h2>–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –º–æ–¥–µ–ª–∏ AI (—á–µ—Ä–µ–∑ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)</h2>
    <label for="input_message_for_ai">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏</label>
    <input id="input_message_for_ai" type="text">
    <button onclick="sendMessageToAI()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <h4>AI RESPONSE: <code id="ai_response"></code></h4>
</div>

<hr>

<div>
    <h2>–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –º–æ–¥–µ–ª–∏ AI (–Ω–∞–ø—Ä—è–º—É—é. –í –†–§ –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å)</h2>
    <label for="input_message_for_ai_right_now">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏</label>
    <input id="input_message_for_ai_right_now" type="text">
    <button onclick="sendMessageToAIRightNow()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <h4>AI RESPONSE: <code id="ai_response_right_now"></code></h4>
</div>

<hr>

<div>
    <h2>–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –¥—Ä—É–≥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É –ø–æ SID</h2>
    <label for="input_message_for_other_client">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏</label>
    <input id="input_message_for_other_client" type="text">
    <label for="input_client_sid">–í–≤–µ–¥–∏—Ç–µ SID –ø–æ–ª—É—á–∞—Ç–µ–ª—è</label>
    <input id="input_client_sid" type="text">
    <button onclick="sendMessageToOtherClient()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <h4>AI RESPONSE: <code id="message_from_client"></code></h4>
</div>

<script>
    const jwtToken = document.getElementById('jwt_token').value;
    console.log('YOUR JWT TOKEN == ', jwtToken);

    // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É socket.io
    const socket = io(
        '{{ host_addr }}',
        {
            auth: {
                token: jwtToken,
                hueken: 'hueken_val'
            }
        }
    );

    // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Å–ª—É—á–∞–µ –∞–ø–≥—Ä–µ–π–¥–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ —Å–æ–∫–µ—Ç–æ–≤
    const engine = socket.io.engine;
    engine.once("upgrade", () => {
        console.log(engine.transport.name); // in most cases, prints "websocket"
        console.log('Upgrade transport and change SID. NEW SID: ', socket.id);
        document.getElementById('socket_sid').innerText = `${socket.id}`;
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
    socket.on('connect', () => {
        console.log('Connected to server');
        console.log('SID: ', socket.id);
        document.getElementById('socket_sid').innerText = `${socket.id}`;
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
    socket.on('disconnect', () => {
        console.log('Disconnected from server');
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å–æ–±—ã—Ç–∏—è —Å —Å–µ—Ä–≤–µ—Ä–∞
    socket.on('base_server_event', (data) => {
        console.log('Received data from server:', data);
        document.getElementById('server_response').innerText = `${data.message}`;
    });

    // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    function sendMessage() {
        const message = document.getElementById('input_message').value;
        socket.emit('client_event', { message });
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–º—É –∑–∞–ø—Ä–æ—Å—É –∫ –º–æ–¥–µ–ª–∏ AI —á–µ—Ä–µ–∑ —Å—Ç–æ—Ä–æ–Ω–µ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    function sendMessageToAI() {
        const aiMessage = document.getElementById('input_message_for_ai').value;
        socket.emit('client_event_for_ai', { aiMessage });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ –Ω–µ–π—Ä–æ–Ω–∫–µ —á–µ—Ä–µ–∑ —Å—Ç–æ—Ä–æ–Ω–µ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    socket.on('server_ai_answer', (data) => {
        console.log('Received data from server (AI Answer):', data);
        document.getElementById('ai_response').innerText = `${data.message}`;
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–º—É –∑–∞–ø—Ä–æ—Å—É –∫ –º–æ–¥–µ–ª–∏ AI –Ω–∞–ø—Ä—è–º—É—é
    function sendMessageToAIRightNow() {
        const aiMessage = document.getElementById('input_message_for_ai_right_now').value;
        socket.emit('client_event_for_ai_right_now', { aiMessage });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ –Ω–µ–π—Ä–æ–Ω–∫–µ –Ω–∞–ø—Ä—è–º—É—é
    socket.on('server_ai_answer_right_now', (data) => {
        console.log('Received data from server (AI Answer, right now):', data);
        document.getElementById('ai_response_right_now').innerText = `${data.message}`;
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –¥—Ä—É–≥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ SID
    function sendMessageToOtherClient() {
        const clientMessage = document.getElementById('input_message_for_other_client').value;
        const clientSid = document.getElementById('input_client_sid').value;
        socket.emit('send_msg_to_user_by_sid', { clientMessage, clientSid });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ –Ω–µ–π—Ä–æ–Ω–∫–µ —á–µ—Ä–µ–∑ —Å—Ç–æ—Ä–æ–Ω–µ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    socket.on('message_from_user', (data) => {
        console.log('Received data from other client:', data);
        document.getElementById('message_from_client').innerText = `${data.message}`;
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ —Å –Ω–æ–≤—ã–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º
    socket.on('new_notification', (data) => {
        console.log('Received notification data:', data);
        document.getElementById('new_notification').innerText = `${data.message}`;
    });
</script>

</body>
</html>
